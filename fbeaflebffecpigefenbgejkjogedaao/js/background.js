(()=>{var e={1448:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3007),t)},2015:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.LoggerConfig=t.LogLevel=void 0,function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.TRACE=4]="TRACE"}(r||(t.LogLevel=r={}));class n{}t.LoggerConfig=n,n.globalIncludeTime=!0;class o{constructor(e,t=null){this.level=e,this.includeTime=t??n.globalIncludeTime,this.fakeTimeForTests=!1}static defaultLogger(){return new o(o.defaultLevel())}static defaultLevel(){return r.INFO}log(e,t,r,n,o){this.level>=e&&console[n](...this.getPrefix(t,r).concat(Array.from(o)))}error(...e){this.log(r.ERROR,"E",o.ERROR_COLOR,"trace",e)}warn(...e){this.log(r.WARN,"W",o.WARN_COLOR,"info",e)}info(...e){this.log(r.INFO,"I",o.INFO_COLOR,"info",e)}debug(...e){this.log(r.DEBUG,"D",o.DEBUG_COLOR,"debug",e)}trace(...e){this.log(r.TRACE,"T",o.TRACE_COLOR,"trace",e)}traceNoStack(...e){this.log(r.TRACE,"T",o.TRACE_COLOR,"debug",e)}isDebugEnabled(){return this.level>=r.DEBUG}isInfoEnabled(){return this.level>=r.INFO}isTraceEnabled(){return this.level>=r.TRACE}getPrefix(e,t){const r={text:`%c[${e}]`,style:`color: ${t}; font-weight: bold;`},n=new Date,s=`${n.getMilliseconds()}`.padStart(3,"0"),i={text:`%c(${this.fakeTimeForTests?o.TESTS_FAKE_TIME:n.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})+"."+s})`,style:o.TIME_STYLE};return this.includeTime?[i.text+" "+r.text,i.style,r.style]:[r.text,r.style]}__testSetFakeTime(){this.fakeTimeForTests=!0}}t.Logger=o,o.TESTS_FAKE_TIME="12:34:56.789",o.TIME_STYLE="color: #303030; font-weight: 600;",o.ERROR_COLOR="red",o.WARN_COLOR="goldenrod",o.INFO_COLOR="blue",o.DEBUG_COLOR="green",o.TRACE_COLOR="purple"},3007:(e,t)=>{"use strict";function r(e,t,r,n,o,s,i,a,c){return{ctrl:e,shift:t,alt:r,meta:n,digit:o,letter:s,capsLock:i,code:a,key:c}}var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Shortcuts=t.CapsLock=void 0,t.isEventInTextField=function(e){const t=e.target?.tagName?.toLowerCase();if(function(e){const t=e.hasAttribute("contenteditable"),r=e.getAttribute("contenteditable");return"true"===r||"plaintext-only"===r||t&&""===r}(e.target)||"input"===t&&(r=e.target,!["button","submit","reset","checkbox","radio","file","image","range","color","hidden"].includes(r.type))||"textarea"===t)return!0;var r;return!1},function(e){e[e.Ignore=0]="Ignore",e[e.Remove=1]="Remove"}(n||(t.CapsLock=n={}));class o{static newEmpty(){return r(!1,!1,!1,!1,!1,!1,!1,null,null)}static simple(e){const t=1===e.length&&e>="0"&&e<="9",n=!t&&e.toUpperCase()===e,o=1===e.length&&(e>="a"&&e<="z"||e>="A"&&e<="Z");return r(!1,n,!1,!1,t,o,!1,t?"Digit"+e:o?"Key"+e.toUpperCase():e,e)}static keyAndCode(e,t){return r(!1,!1,!1,!1,!1,!1,!1,t,e)}static shifted(e){const t=e.letter&&e.key&&1===e.key.length&&e.key>="a"&&e.key<="z"?e.key.toUpperCase():e.key;return o.customize(e,{shift:!0,key:t})}static customize(e,t){return{...e,...t}}static fromJsonObject(e){const t=o.newEmpty();return Object.assign(t,e),t}static isEmpty(e){return!1===e.ctrl&&!1===e.shift&&!1===e.alt&&!1===e.meta&&!1===e.digit&&!1===e.letter&&null===e.code&&null===e.key}static fromKeyDownEvent(e,t){const s=r(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,e.code.startsWith("Digit"),e.code.startsWith("Key"),e.getModifierState("CapsLock"),o.removeForbidden(e.code),o.removeForbidden(e.key));return t===n.Remove?o.withoutCapsLock(s):s}static withoutCapsLock(e){return e.capsLock&&!e.shift&&null!==e.key&&e.key===e.key?.toUpperCase()?o.customize(e,{key:e.key.toLowerCase(),capsLock:!1}):o.customize(e,{capsLock:!1})}static removeForbidden(e){return"CapsLock"===e?null:e}static countBoolean(e){return e?1:0}static bitCount(e){return o.countBoolean(e.ctrl)+o.countBoolean(e.shift)+o.countBoolean(e.alt)+o.countBoolean(e.meta)+o.countBoolean(e.digit)+o.countBoolean(e.letter)+o.countBoolean(!!e.code)+o.countBoolean(!!e.key)}static hasAnyModifiers(e){return e.ctrl||e.shift||e.alt||e.meta}static usesArrowKey(e){const t=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];return!!e.code&&!!e.key&&t.some((t=>t===e.code))&&t.some((t=>t===e.key))}static equals(e,t){return null!==t&&o.repr(e)===o.repr(t)}static repr(e){return"c="+o.booleanRepr(e.ctrl)+",s="+o.booleanRepr(e.shift)+",a="+o.booleanRepr(e.alt)+",m="+o.booleanRepr(e.meta)+",d="+o.booleanRepr(e.digit)+",l="+o.booleanRepr(e.letter)+",(code="+e.code+")(key="+e.key+")"}static modsSet(e){return new Set(["ctrl","shift","alt","meta"].filter((t=>e[t])))}static booleanRepr(e){return e?"T":"F"}}t.Shortcuts=o},5287:(e,t)=>{"use strict";
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,v={};function b(e,t,r){this.props=e,this.context=t,this.refs=v,this.updater=r||g}function y(){}function _(e,t,r){this.props=e,this.context=t,this.refs=v,this.updater=r||g}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=b.prototype;var m=_.prototype=new y;m.constructor=_,h(m,b.prototype),m.isPureReactComponent=!0;var S=Array.isArray,O=Object.prototype.hasOwnProperty,E={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,n){var o,s={},i=null,a=null;if(null!=t)for(o in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(i=""+t.key),t)O.call(t,o)&&!C.hasOwnProperty(o)&&(s[o]=t[o]);var c=arguments.length-2;if(1===c)s.children=n;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];s.children=u}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===s[o]&&(s[o]=c[o]);return{$$typeof:r,type:e,key:i,ref:a,props:s,_owner:E.current}}function j(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var w=/\/+/g;function k(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,o,s,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case r:case n:c=!0}}if(c)return i=i(c=e),e=""===s?"."+k(c,0):s,S(i)?(o="",null!=e&&(o=e.replace(w,"$&/")+"/"),A(i,t,o,"",(function(e){return e}))):null!=i&&(j(i)&&(i=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||c&&c.key===i.key?"":(""+i.key).replace(w,"$&/")+"/")+e)),t.push(i)),1;if(c=0,s=""===s?".":s+":",S(e))for(var u=0;u<e.length;u++){var l=s+k(a=e[u],u);c+=A(a,t,o,l,i)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(a=e.next()).done;)c+=A(a=a.value,t,o,l=s+k(a,u++),i);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function T(e,t,r){if(null==e)return e;var n=[],o=0;return A(e,n,"","",(function(e){return t.call(r,e,o++)})),n}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},L={transition:null},D={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:L,ReactCurrentOwner:E};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,r){T(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!j(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=b,t.Fragment=o,t.Profiler=i,t.PureComponent=_,t.StrictMode=s,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=M,t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=h({},e.props),s=e.key,i=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,a=E.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)O.call(t,u)&&!C.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}return{$$typeof:r,type:e.type,key:s,ref:i,props:o,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=j,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,r){return I.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,r){return I.current.useReducer(e,t,r)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return I.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return I.current.useTransition()},t.version="18.3.1"},5310:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(2015),t)},6540:(e,t,r)=>{"use strict";e.exports=r(5287)},8142:(e,t,r)=>{e=r.nmd(e);var n="__lodash_hash_undefined__",o=9007199254740991,s="[object Arguments]",i="[object Array]",a="[object Boolean]",c="[object Date]",u="[object Error]",l="[object Function]",d="[object Map]",f="[object Number]",p="[object Object]",g="[object Promise]",h="[object RegExp]",v="[object Set]",b="[object String]",y="[object Symbol]",_="[object WeakMap]",m="[object ArrayBuffer]",S="[object DataView]",O=/^\[object .+?Constructor\]$/,E=/^(?:0|[1-9]\d*)$/,C={};C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C[s]=C[i]=C[m]=C[a]=C[S]=C[c]=C[u]=C[l]=C[d]=C[f]=C[p]=C[h]=C[v]=C[b]=C[_]=!1;var R="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,j="object"==typeof self&&self&&self.Object===Object&&self,w=R||j||Function("return this")(),k=t&&!t.nodeType&&t,A=k&&e&&!e.nodeType&&e,T=A&&A.exports===k,P=T&&R.process,I=function(){try{return P&&P.binding&&P.binding("util")}catch(e){}}(),L=I&&I.isTypedArray;function D(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function M(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function N(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var V,x,F,U=Array.prototype,$=Function.prototype,B=Object.prototype,z=w["__core-js_shared__"],J=$.toString,W=B.hasOwnProperty,K=(V=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"",H=B.toString,q=RegExp("^"+J.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),G=T?w.Buffer:void 0,Y=w.Symbol,Q=w.Uint8Array,X=B.propertyIsEnumerable,Z=U.splice,ee=Y?Y.toStringTag:void 0,te=Object.getOwnPropertySymbols,re=G?G.isBuffer:void 0,ne=(x=Object.keys,F=Object,function(e){return x(F(e))}),oe=Ie(w,"DataView"),se=Ie(w,"Map"),ie=Ie(w,"Promise"),ae=Ie(w,"Set"),ce=Ie(w,"WeakMap"),ue=Ie(Object,"create"),le=Ne(oe),de=Ne(se),fe=Ne(ie),pe=Ne(ae),ge=Ne(ce),he=Y?Y.prototype:void 0,ve=he?he.valueOf:void 0;function be(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ye(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _e(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function me(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new _e;++t<r;)this.add(e[t])}function Se(e){var t=this.__data__=new ye(e);this.size=t.size}function Oe(e,t){var r=Fe(e),n=!r&&xe(e),o=!r&&!n&&Ue(e),s=!r&&!n&&!o&&We(e),i=r||n||o||s,a=i?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],c=a.length;for(var u in e)!t&&!W.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Me(u,c))||a.push(u);return a}function Ee(e,t){for(var r=e.length;r--;)if(Ve(e[r][0],t))return r;return-1}function Ce(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ee&&ee in Object(e)?function(e){var t=W.call(e,ee),r=e[ee];try{e[ee]=void 0;var n=!0}catch(e){}var o=H.call(e);n&&(t?e[ee]=r:delete e[ee]);return o}(e):function(e){return H.call(e)}(e)}function Re(e){return Je(e)&&Ce(e)==s}function je(e,t,r,n,o){return e===t||(null==e||null==t||!Je(e)&&!Je(t)?e!=e&&t!=t:function(e,t,r,n,o,l){var g=Fe(e),_=Fe(t),O=g?i:De(e),E=_?i:De(t),C=(O=O==s?p:O)==p,R=(E=E==s?p:E)==p,j=O==E;if(j&&Ue(e)){if(!Ue(t))return!1;g=!0,C=!1}if(j&&!C)return l||(l=new Se),g||We(e)?Ae(e,t,r,n,o,l):function(e,t,r,n,o,s,i){switch(r){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case m:return!(e.byteLength!=t.byteLength||!s(new Q(e),new Q(t)));case a:case c:case f:return Ve(+e,+t);case u:return e.name==t.name&&e.message==t.message;case h:case b:return e==t+"";case d:var l=M;case v:var p=1&n;if(l||(l=N),e.size!=t.size&&!p)return!1;var g=i.get(e);if(g)return g==t;n|=2,i.set(e,t);var _=Ae(l(e),l(t),n,o,s,i);return i.delete(e),_;case y:if(ve)return ve.call(e)==ve.call(t)}return!1}(e,t,O,r,n,o,l);if(!(1&r)){var w=C&&W.call(e,"__wrapped__"),k=R&&W.call(t,"__wrapped__");if(w||k){var A=w?e.value():e,T=k?t.value():t;return l||(l=new Se),o(A,T,r,n,l)}}if(!j)return!1;return l||(l=new Se),function(e,t,r,n,o,s){var i=1&r,a=Te(e),c=a.length,u=Te(t),l=u.length;if(c!=l&&!i)return!1;var d=c;for(;d--;){var f=a[d];if(!(i?f in t:W.call(t,f)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var g=!0;s.set(e,t),s.set(t,e);var h=i;for(;++d<c;){var v=e[f=a[d]],b=t[f];if(n)var y=i?n(b,v,f,t,e,s):n(v,b,f,e,t,s);if(!(void 0===y?v===b||o(v,b,r,n,s):y)){g=!1;break}h||(h="constructor"==f)}if(g&&!h){var _=e.constructor,m=t.constructor;_==m||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof m&&m instanceof m||(g=!1)}return s.delete(e),s.delete(t),g}(e,t,r,n,o,l)}(e,t,r,n,je,o))}function we(e){return!(!ze(e)||function(e){return!!K&&K in e}(e))&&($e(e)?q:O).test(Ne(e))}function ke(e){if(r=(t=e)&&t.constructor,n="function"==typeof r&&r.prototype||B,t!==n)return ne(e);var t,r,n,o=[];for(var s in Object(e))W.call(e,s)&&"constructor"!=s&&o.push(s);return o}function Ae(e,t,r,n,o,s){var i=1&r,a=e.length,c=t.length;if(a!=c&&!(i&&c>a))return!1;var u=s.get(e);if(u&&s.get(t))return u==t;var l=-1,d=!0,f=2&r?new me:void 0;for(s.set(e,t),s.set(t,e);++l<a;){var p=e[l],g=t[l];if(n)var h=i?n(g,p,l,t,e,s):n(p,g,l,e,t,s);if(void 0!==h){if(h)continue;d=!1;break}if(f){if(!D(t,(function(e,t){if(i=t,!f.has(i)&&(p===e||o(p,e,r,n,s)))return f.push(t);var i}))){d=!1;break}}else if(p!==g&&!o(p,g,r,n,s)){d=!1;break}}return s.delete(e),s.delete(t),d}function Te(e){return function(e,t,r){var n=t(e);return Fe(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,Ke,Le)}function Pe(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function Ie(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return we(r)?r:void 0}be.prototype.clear=function(){this.__data__=ue?ue(null):{},this.size=0},be.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},be.prototype.get=function(e){var t=this.__data__;if(ue){var r=t[e];return r===n?void 0:r}return W.call(t,e)?t[e]:void 0},be.prototype.has=function(e){var t=this.__data__;return ue?void 0!==t[e]:W.call(t,e)},be.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ue&&void 0===t?n:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,r=Ee(t,e);return!(r<0)&&(r==t.length-1?t.pop():Z.call(t,r,1),--this.size,!0)},ye.prototype.get=function(e){var t=this.__data__,r=Ee(t,e);return r<0?void 0:t[r][1]},ye.prototype.has=function(e){return Ee(this.__data__,e)>-1},ye.prototype.set=function(e,t){var r=this.__data__,n=Ee(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},_e.prototype.clear=function(){this.size=0,this.__data__={hash:new be,map:new(se||ye),string:new be}},_e.prototype.delete=function(e){var t=Pe(this,e).delete(e);return this.size-=t?1:0,t},_e.prototype.get=function(e){return Pe(this,e).get(e)},_e.prototype.has=function(e){return Pe(this,e).has(e)},_e.prototype.set=function(e,t){var r=Pe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},me.prototype.add=me.prototype.push=function(e){return this.__data__.set(e,n),this},me.prototype.has=function(e){return this.__data__.has(e)},Se.prototype.clear=function(){this.__data__=new ye,this.size=0},Se.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Se.prototype.get=function(e){return this.__data__.get(e)},Se.prototype.has=function(e){return this.__data__.has(e)},Se.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ye){var n=r.__data__;if(!se||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new _e(n)}return r.set(e,t),this.size=r.size,this};var Le=te?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,s=[];++r<n;){var i=e[r];t(i,r,e)&&(s[o++]=i)}return s}(te(e),(function(t){return X.call(e,t)})))}:function(){return[]},De=Ce;function Me(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||E.test(e))&&e>-1&&e%1==0&&e<t}function Ne(e){if(null!=e){try{return J.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ve(e,t){return e===t||e!=e&&t!=t}(oe&&De(new oe(new ArrayBuffer(1)))!=S||se&&De(new se)!=d||ie&&De(ie.resolve())!=g||ae&&De(new ae)!=v||ce&&De(new ce)!=_)&&(De=function(e){var t=Ce(e),r=t==p?e.constructor:void 0,n=r?Ne(r):"";if(n)switch(n){case le:return S;case de:return d;case fe:return g;case pe:return v;case ge:return _}return t});var xe=Re(function(){return arguments}())?Re:function(e){return Je(e)&&W.call(e,"callee")&&!X.call(e,"callee")},Fe=Array.isArray;var Ue=re||function(){return!1};function $e(e){if(!ze(e))return!1;var t=Ce(e);return t==l||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Be(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}function ze(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Je(e){return null!=e&&"object"==typeof e}var We=L?function(e){return function(t){return e(t)}}(L):function(e){return Je(e)&&Be(e.length)&&!!C[Ce(e)]};function Ke(e){return null!=(t=e)&&Be(t.length)&&!$e(t)?Oe(e):ke(e);var t}e.exports=function(e,t){return je(e,t)}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e,t;e||(e={}),function(e){e.CSS_INJECT_COMMON_STYLES="B2C_CSS_INJECT_COMMON_STYLES"}(t||(t={}));var n=r(1448);class o{static MONITOR_FREQ_MSEC=150;static DETECT_LOOP_SEC_BEFORE_END=2;static DETECT_LOOP_WITHIN_SEC_AFTER_START=2;static DETECT_JUMP_WHEN_TIME_MOVE_BY_SEC=1;static SHORTCUT_PLUS_TEN_SEC_L={shortcut:n.Shortcuts.simple("l"),enabled:!0}}if(o.DETECT_LOOP_SEC_BEFORE_END<=o.MONITOR_FREQ_MSEC/1e3)throw new Error("TIME_JUMP_DETECT_LOOP_SEC_BEFORE_END must be greater than TIME_JUMP_MONITOR_FREQ_MSEC / 1000");if(o.DETECT_LOOP_WITHIN_SEC_AFTER_START<=o.MONITOR_FREQ_MSEC/1e3)throw new Error("TIME_JUMP_DETECT_LOOP_WITHIN_SEC_AFTER_START must be greater than TIME_JUMP_MONITOR_FREQ_MSEC / 1000");const s={Space:"Pause/Resume the Short",KeyK:"Pause/Resume the Short",KeyJ:"Jump backward 10 seconds",KeyL:"Jump forward 10 seconds",Comma:"Move video back one frame",Period:"Move video forward one frame"};var i=r(6540);const a=e=>{let t;const r=new Set,n=(e,n)=>{const o="function"==typeof e?e(t):e;if(!Object.is(o,t)){const e=t;t=(null!=n?n:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach((r=>r(t,e)))}},o=()=>t,s={setState:n,getState:o,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(n,o,s);return s},c=e=>e;const u=e=>{const t=(e=>e?a(e):a)(e),r=e=>function(e,t=c){const r=i.useSyncExternalStore(e.subscribe,(()=>t(e.getState())),(()=>t(e.getInitialState())));return i.useDebugValue(r),r}(t,e);return Object.assign(r,t),r};var l,d,f,p=r(5310),g=r(8142),h=r.n(g);function v(e){e.savedAt=Date.now()}function b(e,t){const r=structuredClone(e);delete r.logger,delete r.savedAt;const n=structuredClone(t);return delete n.logger,delete n.savedAt,h()(r,n)}function y(e,t){const r=e,n=Object.keys(t).filter((e=>"logger"!==e&&"savedAt"!==e));try{for(const o of n){if(!(o in e))continue;const n=r[o];if(null===n)continue;const s=typeof t[o],i=typeof n;if(s!==i)throw new Error(`type mismatch for field "${o}": expected "${s}", found "${i}"`)}return!0}catch(e){return t.logger.info(`Invalid user prefs: ${e.message}`),!1}}function _(e,t,r,n){return null==t||"object"!=typeof t||Array.isArray(t)?(n&&n.info(`Invalid "${e}" field in user preferences; replacing with default.`),r):t}function m(e,t,r,n){const o=function(e,t,r,n){let o;for(o in r)o in t||(n.info(`Missing field in under "${e}": ${String(o)}`),t=Object.assign(t,{[o]:r[o]}));return t}(e,_(e,t,r,n),r,n),s=function(e,t,r,n){let o;for(o in t)o in r||(n.info(`Unknown "${e}" field, removing: ${String(o)}`),delete t[o]);return t}(e,o,r,n);return s}!function(e){e.PREFS="prefs",e.SAVED_VIDEOS="savedVideos",e.VIDEO_STATES_PREFIX="VS:",e.VIDEO_STATES_INDEX="videoStatesIndex"}(l||(l={}));class S{static get(e,t){chrome.storage.local.get(e,t)}static set(e,t,r){chrome.storage.local.set({[e]:t},r)}static setMultiple(e,t){chrome.storage.local.set(e,t)}static delete(e,t){chrome.storage.local.remove(e,t)}static deleteMultiple(e,t){chrome.storage.local.remove(e,t)}static getStorageNamespace(){return"local"}}!function(e){e[e.none=1]="none",e[e.showNotification=2]="showNotification"}(d||(d={})),function(e){e[e.startPlaying=1]="startPlaying",e[e.keepCurrentState=2]="keepCurrentState",e[e.preserveSavedState=3]="preserveSavedState"}(f||(f={}));function O(e,t=d.none,r=!0){return{shortcut:e,feedback:t,enabled:r}}function E(e,t=!1,r=!0){return{shortcut:e,enabled:r,showProgressBar:t}}var C;!function(e){e.Top="top",e.Middle="middle",e.Bottom="bottom"}(C||(C={}));const R={likeVideo:O(n.Shortcuts.keyAndCode("[","BracketLeft"),d.showNotification),dislikeVideo:O(n.Shortcuts.keyAndCode("]","BracketRight"),d.showNotification),pictureInPicture:O(n.Shortcuts.simple("h")),openTranscript:O(n.Shortcuts.simple("g")),channelInfo:O(n.Shortcuts.simple("y")),watchNextOverlays:O(n.Shortcuts.newEmpty(),void 0,!1),progressBarTicks:O(n.Shortcuts.keyAndCode("`","Backquote")),speedFaster:O(n.Shortcuts.shifted(n.Shortcuts.keyAndCode("}","BracketRight")),d.showNotification),speedSlower:O(n.Shortcuts.shifted(n.Shortcuts.keyAndCode("{","BracketLeft")),d.showNotification),shortsOpenComments:O(n.Shortcuts.simple("c")),shortsSwitchToRegular:O(n.Shortcuts.simple("w")),shortsSwitchToRegularNewWindow:O(n.Shortcuts.shifted(n.Shortcuts.simple("w"))),shortsFullscreen:O(n.Shortcuts.simple("f"))},j={bookmarkBackup:O(n.Shortcuts.simple("b"),d.showNotification),bookmarkDelete:O(n.Shortcuts.simple("B"),d.showNotification),bookmarkRestore:O(n.Shortcuts.simple("r"),d.showNotification),undoJump:O(n.Shortcuts.simple("u")),deleteOnRestore:!1},w={oneMinus:E(n.Shortcuts.simple("z")),onePlus:E(n.Shortcuts.simple("x")),oneValue:3,twoMinus:E(n.Shortcuts.shifted(n.Shortcuts.simple("z"))),twoPlus:E(n.Shortcuts.shifted(n.Shortcuts.simple("x"))),twoValue:1},k=e=>({enabled:e,feedback:d.none}),A=()=>k(!0),T={shortsEnableZeroToNine:A(),shortsMinusTenSec:A(),shortsPlusTenSec:A(),shortsNextVideo:A(),shortsPreviousVideo:A(),shortsPreviousFrame:A(),shortsNextFrame:A(),skip5SecOverlays:A(),removeWatchNextOverlays:k(!1),addRightColumnButtons:A(),enableNotificationEmojis:A(),shortsAutoPlayNext:A(),pauseResumeOnChannelModal:A(),openLinksInNewTab:A(),removeProgressGradient:A()},P={speedChangeAmount:{enabled:!0,amount:5},bookmarkMaxAge:{enabled:!0,amount:24},bookmarkMaxVideos:{enabled:!0,amount:100},notificationsDurationMs:{enabled:!0,amount:2e3}},I={preferredLanguage:"en-US",defaultBlockSizeIndex:1,transcriptHighlightPosition:C.Middle};class L{static load(e){L.loadAndMaybeReSave(e,!1)}static loadAndRepair(e){L.loadAndMaybeReSave(e,!0)}static loadAndMaybeReSave(e,t){const r=p.Logger.defaultLogger();r.debug(`UserPrefsLoader::loadAndMaybeReSave(canSave=${t})`),S.get(l.PREFS,(n=>{if(r.debug("UserPrefsLoader::RAW PREFS:",n[l.PREFS]),n[l.PREFS]){const r=L.validateAndRebuildUserPrefsObjects(n[l.PREFS],t);0,b(r,n[l.PREFS])||r.logger.debug("UserPrefsLoader::REPAIRED PREFS, NOW:",r),e(r)}else L.initStorage(e)}))}static initStorage(e){const t=L.create();t.logger.debug("[UserPrefs::initStorage] create returned",t),S.set(l.PREFS,t,(()=>{e(t)}))}static create(){return{savedAt:Date.now(),logLevel:p.Logger.defaultLevel(),logger:p.Logger.defaultLogger(),keys:R,backupRestore:j,manualTimeSkips:w,generalBoolOptions:T,generalNumberOptions:P,transcriptOptions:I}}static delete(e=()=>{}){S.delete(l.PREFS,(()=>{e&&e()}))}static validateAndRebuildUserPrefsObjects(e,t){const r=structuredClone(e),n={},o=L.create();Object.assign(n,e),n.logLevel&&"number"==typeof n.logLevel||(n.logLevel=o.logLevel),n.logger=new p.Logger(n.logLevel);L.validateUserPrefsObject(n)||(n.logger.debug("Replacing saved user preferences with clean slate"),Object.assign(n,o)),n.keys=m("keys",n.keys,o.keys,n.logger),n.manualTimeSkips=m("manualTimeSkips",n.manualTimeSkips,o.manualTimeSkips,n.logger),n.backupRestore=m("backupRestore",n.backupRestore,o.backupRestore,n.logger),n.generalBoolOptions=m("generalBoolOptions",n.generalBoolOptions,o.generalBoolOptions,n.logger),n.generalNumberOptions=m("generalNumberOptions",n.generalNumberOptions,o.generalNumberOptions,n.logger),n.transcriptOptions=m("transcriptOptions",n.transcriptOptions,o.transcriptOptions,n.logger);const s=Object.keys(n);for(const e of s)e in o||delete n[e];return t&&!b(n,r)&&L.saveUserPrefsIfPossible(n),n}static saveUserPrefsIfPossible(e){e.logger&&e.logger.debug("Storing user prefs directly"),L.save(e,(()=>{e.logger&&e.logger.debug("User prefs stored")}))}static validateUserPrefsObject(e){return y(e,L.create())}static save(e,t=()=>{}){e.logger&&e.logger.debug("[UserPrefs::save]");const r=structuredClone(e);v(r),delete r.logger,S.set(l.PREFS,r,t)}}(D?u(D):u)((e=>({prefs:L.create(),setPrefs:t=>e({prefs:t}),watchNextOverlaysVisible:!1,setWatchNextOverlaysVisible:t=>e({watchNextOverlaysVisible:t}),channelModalActive:!1,setChannelModalActive:t=>e({channelModalActive:t})})));var D;[".ytp-ce-video.ytp-ce-large-round",".ytp-ce-playlist.ytp-ce-large-round",".ytp-ce-large-round .ytp-ce-expanding-overlay-background",".ytp-ce-video.ytp-ce-medium-round",".ytp-ce-playlist.ytp-ce-medium-round",".ytp-ce-medium-round .ytp-ce-expanding-overlay-background",".ytp-ce-video.ytp-ce-small-round",".ytp-ce-playlist.ytp-ce-small-round",".ytp-ce-small-round .ytp-ce-expanding-overlay-background",".ytp-ce-element.ytp-ce-channel",".ytp-ce-element.ytp-ce-website",".ytp-ce-element.ytp-ce-merchandise"].join(", ");const M={display:["none","!important"],visibility:"hidden",width:"0px",height:"0px",opacity:"0"},N=Object.entries(M).map((([e,t])=>Array.isArray(t)?`${e}: ${t.join(" ")};`:`${e}: ${t};`)).join(" "),V="custom-hiding-id";const x="controls-for-youtube-progress-indicator",F=".ytp-play-progress";class U{static add(e,t,r,n){S.get(l.SAVED_VIDEOS,(o=>{const s=o.savedVideos?o.savedVideos:U.create();s.savedPoints[t]=r;const i=U.cleanupSavedPositions(s,e.generalNumberOptions.bookmarkMaxAge.amount,e.generalNumberOptions.bookmarkMaxVideos.amount)??s;U.save(i,n)}))}static remove(e,t){S.get(l.SAVED_VIDEOS,(r=>{const n=r.savedVideos?r.savedVideos:U.create();n.savedPoints[e]?(delete n.savedPoints[e],U.save(n,(()=>{t&&t(!0)}))):t&&t(!1)}))}static removeAll(e){S.delete(l.SAVED_VIDEOS,e||(()=>{}))}static cleanupSavedPositions(e,t,r){const n=function(e){const t=structuredClone(e);return t.logger=new p.Logger(t.logLevel),t}(e),o=Date.now(),s=3600*t*1e3,i=Object.entries(n.savedPoints).sort(((e,t)=>t[1].savedAt-e[1].savedAt)),a=i.slice(0,Math.min(r,i.length)),c=new Set;for(const[e,t]of a)o-t.savedAt>s&&c.add(e);const u={};for(const[e,t]of a)c.has(e)||(u[e]=t);const l=Object.keys(e.savedPoints).length,d=Object.keys(u).length;return l===d?null:(e.logger&&e.logger.debug(`cleanupOldSavedPositions: before: ${l} points, after: ${d}`),n.savedPoints=u,n)}static load(e){U.loadAndMaybeReSave(e,!1)}static loadAndMaybeReSave(e,t){S.get(l.SAVED_VIDEOS,(r=>{if(r[l.SAVED_VIDEOS]){const n=U.validateAndRebuildSavedVideosObjects(r[l.SAVED_VIDEOS],t);e(n)}else U.initStorage(e)}))}static initStorage(e){const t=U.create();t.logger.debug("[SavedVideosLoader::initStorage] create returned",t),S.set(l.SAVED_VIDEOS,t,(()=>{e(t)}))}static create(e){return{logLevel:e??p.Logger.defaultLevel(),logger:e?new p.Logger(e):p.Logger.defaultLogger(),savedPoints:{},savedAt:Date.now()}}static validateAndRebuildSavedVideosObjects(e,t){const r=structuredClone(e),n={},o=U.create();Object.assign(n,e),n.logLevel&&"number"==typeof n.logLevel||(n.logLevel=o.logLevel),n.logger=new p.Logger(n.logLevel);U.validateSavedVideosObject(n)||(n.logger.debug("Replacing stored savedVideos with clean slate"),Object.assign(n,o)),n.savedPoints=_("savedPoints",n.savedPoints,o.savedPoints,n.logger);for(const e of Object.keys(n.savedPoints)){const t=n.savedPoints[e];void 0!==t.savedAt&&void 0!==t.videoTimeSec||delete n.savedPoints[e];const r=["videoTimeSec","savedAt","unloadSave"];for(const e of Object.keys(t))void 0===r.find((t=>t===e))&&delete t[e]}const s=Object.keys(n);for(const e of s)e in o||delete n[e];return t&&!b(n,r)&&U.storeSavedVideosIfPossible(n),n}static validateSavedVideosObject(e){return y(e,U.create())}static storeSavedVideosIfPossible(e){e.logger&&e.logger.debug("Storing saved videos directly"),U.save(e,(()=>{e.logger&&e.logger.debug("Saved videos stored")}))}static save(e,t=()=>{}){const r=structuredClone(e);v(r),delete r.logger,S.set(l.SAVED_VIDEOS,r,t)}}class ${prefs;intervalTimer=null;constructor(e){this.prefs=e}updatePrefs(e){this.prefs=e}isCleanupEventsPollingInstalled(){return null!==this.intervalTimer}installCleanupEvents(){this.prefs.logger.debug("PeriodicSavedVideosCleaner: installing the polling loop and running it once immediately"),this.intervalTimer=setInterval((()=>this.periodicCleanup()),9e5),this.periodicCleanup()}uninstallCleanupEvents(){this.intervalTimer&&(this.prefs.logger.debug("PeriodicSavedVideosCleaner: stopping the polling loop"),clearInterval(this.intervalTimer),this.intervalTimer=null)}periodicCleanup(){this.prefs.logger.debug("PeriodicSavedVideosCleaner::periodicCleanup"),L.load((e=>{U.load((t=>{const r=t.savedPoints?Object.keys(t.savedPoints).length:0;this.prefs.logger.debug(`PeriodicSavedVideosCleaner: pre-cleanup saved videos count: ${r}`);const n=U.cleanupSavedPositions(t,e.generalNumberOptions.bookmarkMaxAge.amount,e.generalNumberOptions.bookmarkMaxVideos.amount);null!==n?(U.save(n),this.prefs.logger.debug(`PeriodicSavedVideosCleaner: post-cleanup saved videos count: ${Object.keys(n.savedPoints).length} (removed ${r-Object.keys(n.savedPoints).length} videos)`)):this.prefs.logger.debug("PeriodicSavedVideosCleaner: no changes were made to the saved videos")}))}))}}var B;!function(e){e.ADD="ADD",e.REMOVE="REMOVE"}(B||(B={}));class z{prefs;constructor(e){this.prefs=e}updatePrefs(e){this.prefs=e}injectOrRemoveCssInSenderTab(e){const{addOrRemove:t,customCss:r,messageSender:n,sendResponse:o}=e;if(!n.tab||!n.tab.id)return this.prefs.logger.debug("CssInjector::NO_SENDER_TAB_OR_TAB_ID"),void o({success:!1,reason:"NO_SENDER_TAB_OR_TAB_ID"});try{let e=Promise.resolve();t===B.ADD?(this.prefs.logger.debug("CssInjector::ADD"),e=chrome.scripting.insertCSS({target:{tabId:n.tab.id},css:r})):t===B.REMOVE&&(this.prefs.logger.debug("CssInjector::REMOVE"),e=chrome.scripting.removeCSS({target:{tabId:n.tab.id},css:r}));const s=t===B.ADD?"add":"remove";e.then((()=>{o({tabId:n.tab?.id,success:!0,action:s+"CustomCSS"})})).catch((e=>{this.prefs.logger.debug(`CssInjector::${s} error:`,e),o({tabId:n.tab?.id,success:!1,reason:s+"CustomCSS",error:e})}))}catch(e){this.prefs.logger.debug("CssInjector::tryCatch error:",e),o({tabId:n.tab?.id,success:!1,reason:"tryCatchFailed",error:e})}}}(new class{cssInjector;savedVideosCleaner;prefs;constructor(){this.prefs=L.create(),this.detectExtensionInstallEvent(),this.detectChromeAboutToBeUpgraded(),this.mapIconClickToOptionsPage(),this.cssInjector=new z(this.prefs),this.savedVideosCleaner=new $(this.prefs)}mapIconClickToOptionsPage(){chrome.action.onClicked.addListener((e=>{chrome.runtime.openOptionsPage().then((()=>{})).catch((e=>{this.prefs.logger.debug("Error opening options page:",e)}))}))}start(){this.prefs.logger.debug("Starting background app"),L.loadAndRepair((e=>{this.prefs=e,this.cssInjector.updatePrefs(e),this.addBackgroundListeners()}))}addBackgroundListeners(){this.listenForUserPrefsStorageUpdates(),this.listenForContentToBackgroundMessages(),this.savedVideosCleaner.installCleanupEvents(),this.detectDisappearingExtensionIdentifier()}detectDisappearingExtensionIdentifier(){setInterval((()=>{chrome&&chrome.runtime&&void 0===chrome.runtime.id&&this.prefs.logger.debug("[BACKGROUND] Detected extension reload!")}),1e3)}listenForUserPrefsStorageUpdates(){chrome.storage.onChanged.addListener(((e,t)=>{if(t===S.getStorageNamespace()&&e.prefs){const t=L.validateAndRebuildUserPrefsObjects(e.prefs.newValue,!1);this.updatePrefs(t)}else this.prefs.logger.debug("storage changed, ignoring:",e,"namespace:",t)}))}updatePrefs(e){this.prefs.logger.debug("storage changed, updating prefs:",e),this.prefs=e,this.cssInjector.updatePrefs(e),this.savedVideosCleaner.updatePrefs(e)}listenForContentToBackgroundMessages(){chrome.runtime.onMessage.addListener(((e,r,n)=>{if(this.prefs.logger.debug("Received message:",e,"sender:",r),void 0===e.type)return!1;if(e.type===t.CSS_INJECT_COMMON_STYLES)this.prefs.logger.debug("injectOrRemoveCss(commonStyles) -- inject ONLY"),this.cssInjector.injectOrRemoveCssInSenderTab({addOrRemove:B.ADD,customCss:`#${V} { ${N} }${F}.${x} {\n        background: #f03 !important;\n    }`,messageSender:r,sendResponse:n});else this.prefs.logger.debug("Unknown request type:",e.type);return!0}))}detectExtensionInstallEvent(){chrome.runtime.onInstalled.addListener((e=>{this.prefs.logger.debug("Received onInstalled event:",e),(async()=>{await this.onInstallEvent(e)})()}))}async onInstallEvent(e){this.savedVideosCleaner.uninstallCleanupEvents(),e.reason===chrome.runtime.OnInstalledReason.INSTALL?this.prefs.logger.debug("This is a first install!"):e.reason===chrome.runtime.OnInstalledReason.UPDATE?this.prefs.logger.debug("This is an extension update. Previous version was "+e.previousVersion):e.reason===chrome.runtime.OnInstalledReason.CHROME_UPDATE?this.prefs.logger.debug("Chrome was upgraded"):e.reason===chrome.runtime.OnInstalledReason.SHARED_MODULE_UPDATE?this.prefs.logger.debug("Shared module was updated"):this.prefs.logger.debug("Unknown onInstalled reason:",e.reason),await this.injectContentJavascriptAndCss(),this.savedVideosCleaner.installCleanupEvents()}async injectContentJavascriptAndCss(){const e=chrome.runtime.getManifest()?.content_scripts??[];this.prefs.logger.debug("About to inject content scripts:",e);for(const t of e){this.prefs.logger.debug("about to inject content script:",t);for(const e of await chrome.tabs.query({url:t.matches}))if(!e?.url?.match(/(chrome|chrome-extension):\/\//gi)){this.prefs.logger.debug("Injecting JS, then CSS into tab ID:",e.id,", URL:",e.url);try{await this.injectContentScriptJavascript(e,t),await this.injectContentScriptStylesheet(e,t)}catch(e){this.prefs.logger.debug("Error injecting content script:",e)}}}}async injectContentScriptJavascript(e,t){if(Array.isArray(t.js)&&t.js.length>=1&&t?.js[0]&&e?.id){const r={tabId:e.id,allFrames:t.all_frames};this.prefs.logger.debug("    injecting JS into tab ID:",e.id),await chrome.scripting.executeScript({files:t.js,injectImmediately:"document_start"===t.run_at,target:r,..."world"in t?{world:t.world}:{}})}else this.prefs.logger.debug("    no JS to inject into tab ID:",e.id)}async injectContentScriptStylesheet(e,t){if(Array.isArray(t.css)&&t.css.length>=1&&t?.css[0]&&e?.id){this.prefs.logger.debug("    injecting CSS into tab ID:",e.id);const r={tabId:e.id,allFrames:t.all_frames};await chrome.scripting.insertCSS({files:t.css,target:r,..."origin"in t?{origin:t.origin}:{}})}else this.prefs.logger.debug("    no CSS to inject into tab ID:",e.id)}detectChromeAboutToBeUpgraded(){chrome.runtime.onUpdateAvailable.addListener((e=>{this.prefs.logger.debug("Reloading, since Chrome is about to be upgraded:",e),chrome.runtime.reload()}))}}).start()})()})();